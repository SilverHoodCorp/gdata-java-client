<?xml version="1.0"?>

  <!--
    You must have JAVA_HOME set to a JDK (minimum 1.5) installation.
  -->
<project basedir="." default="compile" name="gdata">

  <import file="build-common.xml" />
  <import file="build-datajars.xml" />
  <import file="build-clientjars.xml" />

  <property name="classes.test.dir" value="${build.dir}/classes-test" />

  <target name="clean" description="Remove generated files.">
    <delete dir="${build.dir}" />
  </target>

  <target name="zipsrc" depends="dist-init" description="Zip source.">
    <zip destfile="${dist.dir}/gdata-${version}-src.zip" basedir="${src.dir}" />
    <copy file="${dist.dir}/gdata-${version}-src.zip" tofile="${android.dir}/gdata-${version}-src.zip" />
  </target>

  <target name="gdata-full-jar" depends="compile,dist-init">
    <jar destfile="${dist.dir}/gdata-${version}.jar" basedir="${classes.dir}" />
  </target>

  <target name="javadoc" description="Generate JavaDoc" depends="dist-init">
    <property name="javadoc.dir" value="${build.dir}/javadoc" />
    <delete dir="${javadoc.dir}" />
    <mkdir dir="${javadoc.dir}" />
    <javadoc sourcepath="${src.dir}" source="1.5" destdir="${javadoc.dir}"
      use="true" windowtitle="GData Java Library ${version}"
      doctitle="Google Data API (GData) Java Library version ${version}"
      packagenames="${client.packagenames},${data.packagenames},com.google.api.client.googleapis.auth.authsub,com.google.api.client.javanet">
      <classpath>
        <pathelement location="${lib.dir}/${android.jar}" />
        <pathelement location="${lib.dir}/${jackson.jar}" />
      </classpath>
      <link href="http://jackson.codehaus.org/1.4.2/javadoc" />
    </javadoc>
  </target>

  <target name="jars" description="Compile all jars" depends="gdata-full-jar,datajars,clientjars">
    <mkdir dir="${dist.dir}/dependencies" />
    <copy file="${lib.dir}/${jackson.jar}" todir="${android.dir}" />
    <copy file="${lib.dir}/${commons-logging.jar}" todir="${dist.dir}/dependencies" />
    <copy file="${lib.dir}/${httpclient.jar}" todir="${dist.dir}/dependencies" />
    <copy file="${lib.dir}/${httpcore.jar}" todir="${dist.dir}/dependencies" />
    <copy file="${lib.dir}/${jackson.jar}" todir="${dist.dir}/dependencies" />
    <copy file="${lib.dir}/${kxml2.jar}" todir="${dist.dir}/dependencies" />
  </target>

  <target name="readme" description="Readme and other included files">
    <copy file="dist/LICENSE" todir="${dist.dir}" />
    <copy file="dist/LICENSE" todir="${android.dir}" />
    <copy file="dist/readme.html" todir="${dist.dir}" />
    <copy file="android/readme.html" todir="${android.dir}" />
  </target>

  <target name="dist"
    description="Build the distribution zip file that includes all compiled jar files"
    depends="jars,zipsrc,readme">
    <zip destfile="${build.dir}/gdata-java-${version}.zip" basedir="${dist.dir}" />
    <zip destfile="${build.dir}/gdata-android-${version}.zip" basedir="${android.dir}" />
  </target>

  <target name="test" depends="gdata-full-jar" description="Execute JUnit tests.">
    <mkdir dir="${classes.test.dir}" />
    <javac srcdir="${test.dir}" debug="true" destdir="${classes.test.dir}"
      source="1.5" target="1.5">
      <compilerarg value="-Xlint:all" />
      <classpath>
        <pathelement location="${dist.dir}/gdata-${version}.jar" />
        <pathelement location="${lib.dir}/${junit.jar}" />
      </classpath>
    </javac>
    <java fork="true" classname="junit.textui.TestRunner" failonerror="true"
      taskname="junit">
      <classpath>
        <pathelement location="${classes.test.dir}" />
        <pathelement location="${dist.dir}/gdata-${version}.jar" />
        <pathelement location="${lib.dir}/${junit.jar}" />
      </classpath>
      <arg value="com.google.api.client.AllTests" />
    </java>
  </target>

  <target name="all" depends="clean,dist,test,javadoc"
    description="Clean compile, distribute, run tests, and generate JavaDoc" />
</project>
